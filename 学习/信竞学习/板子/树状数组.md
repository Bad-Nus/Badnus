---
tags:
  - 板子
---
# 单改区查

[例题](http://ssloj.cn/contest/262/problem/2)

```cpp
#include<bits/stdc++.h>
#define rep(u,x,y) for(int u=x;u<=y;++u)
#define lowbit(x) (x&-x)
using namespace std;
typedef long long ll;
const int N=1e6+1;
int a[N],n,m,op,x,y;
void init(){rep(i,1,n)a[i+lowbit(i)]+=a[i];}
void upd(int x,int k){while(x<=n)a[x]+=k,x+=lowbit(x);}
ll ask(int x){ll res=0;while(x)res+=a[x],x-=lowbit(x);return res;}
int main(){
    cin>>n>>m;
    rep(i,1,n)cin>>a[i];
    init();
    while(m--){
        cin>>op>>x>>y;
        if(op==1)upd(x,y);
        else cout<<ask(y)-ask(x-1)<<endl;
    }
    return 0;
}
```

# 区改区查
[例题](http://ssloj.cn/contest/262/problem/6)
```cpp
#include<bits/stdc++.h>
#define rep(u,x,y) for(int u=x;u<=y;++u)
#define lowbit(x) (x&-x)
using namespace std;
typedef long long ll;
const int N=1e6+1;
ll n,m,op,x,y,z,xk;
ll a[N],b[N],now,lst;
void init(){rep(i,1,n)a[i+lowbit(i)]+=a[i],b[i+lowbit(i)]+=b[i];}
void add(ll x,ll k){xk=x*k;while(x<=n)a[x]+=k,b[x]+=xk,x+=lowbit(x);}
void upd(ll l,ll r,ll k){add(l,k),add(r+1,-k);}
ll ask(ll *t,int x){ll res=0;while(x)res+=t[x],x-=lowbit(x);return res;}
ll query(ll l,ll r){return ((r+1)*ask(a,r)-ask(b,r))-(l*ask(a,l-1)-ask(b,l-1));}
int main(){
    cin>>n>>m;
    rep(i,1,n)cin>>now,b[i]=(a[i]=now-lst)*i,lst=now;
    init();
    while(m--){
        cin>>op>>x>>y;
        if(op==1)cin>>z,upd(x,y,z);
        else cout<<query(x,y)<<endl;
    }
    return 0;
}
```