---
Tags:
  - 题解
---
# 题面
[SSLOJ-2025-8-13-T4.没有硝烟的战争](../../../题面/SSLOJ题面/2025-8-13A/SSLOJ-2025-8-13-T4.没有硝烟的战争.md)

![[../../../题面/SSLOJ题面/2025-8-13A/SSLOJ-2025-8-13-T4.没有硝烟的战争]]
# 分析
$n,m,k\le 5000$ 我们枚举每个动物 $i$ 报每个数字 $j$ 时是否必胜即可，设 $f_{i,j}$ 为第 $i$ 个动物报数字 $j$ 时是否必胜， $a_i$ 为动物代表的族群是否为狼， $nxt_i$ 第 $i$ 个动物的下一个动物的编号。

求第 $i$ 个动物报第 $j$ 个数字是否必胜，只要知道:
1. **第 $nxt_i$ 个动物是否同族**
2. **第 $nxt_i$ 动物在第 $i$ 个动物报 $j$ 的基础上去报 $[j+1,max(j+k,m)]$ 这些数是否存在必胜方案**。

若是第 $nxt_i$ 动物同族且必胜那么第 $i$ 个动物必胜，或是第 $nxt_i$ 个动物异族且必败那么第 $i$ 个必胜。否则报 $j$ 数字必败，有下转移式

$$
\begin{equation}
\begin{split}
f_{i,j}
&=[(\sum_{v=j+1}^{max(m,j+k)}f_{nxt_i,v})\gt 0]\quad &if(a_i=a_{nxt_i})\\
&=[(\sum_{v=j+1}^{max(m,j+k)}f_{nxt_i,v})\le 0]\quad &if(a_i\neq a_{nxt_i})
\end{split}
\end{equation}
$$

容易发现转移的 $j$ 从高到低， 初始时有 $\forall i\in[1,n],f_{i,m}=0$ ，由此转移便可，转移复杂度 $O(nm^2)$ 。注意到转移式中的 $\sum$ 可由从后向前转移时维护后缀和优化，有

$$
\begin{equation}
\begin{split}
s_{i,j}
&=\sum_{v=j+1}^{max(m,j+k)} f_{i,v}\\
&=f_{i,j}+(s_{i,j+1}-f_{i,j+k})\quad &if(j+k\le m)\\
&=f_{i,j}+(s_{i,j+1})\quad &if(j+k\gt m)
\end{split}
\end{equation}
$$
转移式变为:
$$
\begin{cases}
\begin{split}
f_{i,j}
&=[s_{nxt_i,j+1}\gt 0]\quad &if(a_i=a_{nxt_i})\\
&=[s_{nxt_i,j+1}\le 0]\quad &if(a_i\neq a_{nxt_i})\\
\\
s_{i,j}
&=f_{i,j}+(s_{i,j+1}-f_{i,j+k})\quad &if(j+k\le m)\\
&=f_{i,j}+(s_{i,j+1})\quad &if(j+k\gt m)
\end{split}
\end{cases}
$$
# 代码
```cpp
#include<bits/stdc++.h>
using namespace std;
const int N=5010;
int n,m,k,s[N][N],nxt;
bool f[N][N],a[N];
int main(){
	cin>>n>>m>>k;
	for(int i=1;i<=n;++i)cin>>a[i];
	for(int j=m-1;j;--j)for(int i=1;i<=n;++i){
		nxt=i==n?1:i+1;
		f[j][i]=(a[i]==a[nxt])?s[j+1][nxt]>0:!s[j+1][nxt];
		s[j][i]=(j+k>m)?s[j+1][i]+f[j][i]:s[j+1][i]+f[j][i]-f[j+k][i];
	}
	for(int i=1;i<=n;++i)putchar(!a[i]^bool(s[1][i])+'0'),putchar(' ');
	return 0;
}
```